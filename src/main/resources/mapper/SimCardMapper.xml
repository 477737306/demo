<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cmit.testing.dao.SimCardMapper">
    <resultMap id="BaseResultMap" type="com.cmit.testing.entity.SimCard">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <id column="id" jdbcType="INTEGER" property="id"/>
        <result column="operator" jdbcType="VARCHAR" property="operator"/>
        <result column="province" jdbcType="VARCHAR" property="province"/>
        <result column="phone" jdbcType="VARCHAR" property="phone"/>
        <result column="service_code" jdbcType="VARCHAR" property="serviceCode"/>
        <result column="imsi" jdbcType="VARCHAR" property="imsi"/>
        <result column="month_cost" jdbcType="DOUBLE" property="monthCost"/>
        <result column="month_cost_info" jdbcType="VARCHAR" property="monthCostInfo"/>
        <result column="status" jdbcType="INTEGER" property="status"/>
        <result column="cancel_time" jdbcType="TIMESTAMP" property="cancelTime"/>
        <result column="sim_host" jdbcType="VARCHAR" property="simHost"/>
        <result column="contact_info" jdbcType="VARCHAR" property="contactInfo"/>
        <result column="description" jdbcType="VARCHAR" property="description"/>
        <result column="balance" jdbcType="DOUBLE" property="balance"/>
        <result column="available_status" jdbcType="INTEGER" property="availableStatus"/>
        <result column="brand" jdbcType="VARCHAR" property="brand"/>
        <result column="flow" jdbcType="DOUBLE" property="flow"/>
        <result column="total_point" jdbcType="DOUBLE" property="totalPoint"/>
        <result column="point_balance" jdbcType="DOUBLE" property="pointBalance"/>
        <result column="consume_point" jdbcType="VARCHAR" property="consumePoint"/>
        <result column="promotion_point" jdbcType="VARCHAR" property="promotionPoint"/>
        <result column="synchronized_time" jdbcType="TIMESTAMP" property="synchronizedTime"/>
        <result column="disable_status" jdbcType="INTEGER" property="disableStatus"/>
    </resultMap>
    <sql id="Base_Column_List">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        id, operator, province, phone, service_code, imsi, month_cost, month_cost_info, status,
        cancel_time, sim_host, contact_info, description, balance, available_status, brand, flow,
        total_point, point_balance, consume_point, promotion_point,synchronized_time,disable_status
    </sql>
    <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        select
        <include refid="Base_Column_List"/>
        from sim_card
        where id = #{id,jdbcType=INTEGER}
    </select>

    <!--提供给app侧使用-->
    <select id="getSimCardByImsi" parameterType="java.lang.String" resultMap="BaseResultMap">
        SELECT <include refid="Base_Column_List"/>
        FROM sim_card
        WHERE imsi = #{imsi, jdbcType=VARCHAR}
    </select>
    <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        delete from sim_card
        where id = #{id,jdbcType=INTEGER}
    </delete>
    <insert id="insert" parameterType="com.cmit.testing.entity.SimCard">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        insert into sim_card (id, operator, province,
        phone, service_code, imsi,
        month_cost, month_cost_info, status,
        cancel_time, sim_host, contact_info,
        description, balance, available_status,
        brand, flow, total_point, point_balance,
        consume_point, promotion_point,synchronized_time)
        values (#{id,jdbcType=INTEGER}, #{operator,jdbcType=VARCHAR}, #{province,jdbcType=VARCHAR},
        #{phone,jdbcType=VARCHAR}, #{serviceCode,jdbcType=VARCHAR}, #{imsi,jdbcType=VARCHAR},
        #{monthCost,jdbcType=DOUBLE}, #{monthCostInfo,jdbcType=VARCHAR}, #{status,jdbcType=INTEGER},
        #{cancelTime,jdbcType=TIMESTAMP}, #{simHost,jdbcType=VARCHAR}, #{contactInfo,jdbcType=VARCHAR},
        #{description,jdbcType=VARCHAR}, #{balance,jdbcType=DOUBLE}, #{availableStatus,jdbcType=INTEGER},
        #{brand,jdbcType=VARCHAR}, #{flow,jdbcType=DOUBLE}, #{totalPoint,jdbcType=DOUBLE},
        #{pointBalance,jdbcType=DOUBLE}, #{consumePoint,jdbcType=VARCHAR},
        #{promotionPoint,jdbcType=VARCHAR},#{synchronizedTime,jdbcType=TIMESTAMP})

    </insert>
    <insert id="insertSelective" parameterType="com.cmit.testing.entity.SimCard">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        insert into sim_card
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="id != null">
                id,
            </if>
            <if test="operator != null">
                operator,
            </if>
            <if test="province != null">
                province,
            </if>
            <if test="phone != null">
                phone,
            </if>
            <if test="serviceCode != null">
                service_code,
            </if>
            <if test="imsi != null">
                imsi,
            </if>
            <if test="monthCost != null">
                month_cost,
            </if>
            <if test="monthCostInfo != null">
                month_cost_info,
            </if>
            <if test="status != null">
                status,
            </if>
            <if test="cancelTime != null">
                cancel_time,
            </if>
            <if test="simHost != null">
                sim_host,
            </if>
            <if test="contactInfo != null">
                contact_info,
            </if>
            <if test="description != null">
                description,
            </if>
            <if test="balance != null">
                balance,
            </if>
            <if test="availableStatus != null">
                available_status,
            </if>
            <if test="brand != null">
                brand,
            </if>
            <if test="flow != null">
                flow,
            </if>
            <if test="totalPoint != null">
                total_point,
            </if>
            <if test="pointBalance != null">
                point_balance,
            </if>
            <if test="consumePoint != null">
                consume_point,
            </if>
            <if test="promotionPoint != null">
                promotion_point,
            </if>
            <if test="synchronizedTime!=null">
                synchronized_time,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="id != null">
                #{id,jdbcType=INTEGER},
            </if>
            <if test="operator != null">
                #{operator,jdbcType=VARCHAR},
            </if>
            <if test="province != null">
                #{province,jdbcType=VARCHAR},
            </if>
            <if test="phone != null">
                #{phone,jdbcType=VARCHAR},
            </if>
            <if test="serviceCode != null">
                #{serviceCode,jdbcType=VARCHAR},
            </if>
            <if test="imsi != null">
                #{imsi,jdbcType=VARCHAR},
            </if>
            <if test="monthCost != null">
                #{monthCost,jdbcType=DOUBLE},
            </if>
            <if test="monthCostInfo != null">
                #{monthCostInfo,jdbcType=VARCHAR},
            </if>
            <if test="status != null">
                #{status,jdbcType=INTEGER},
            </if>
            <if test="cancelTime != null">
                #{cancelTime,jdbcType=TIMESTAMP},
            </if>
            <if test="simHost != null">
                #{simHost,jdbcType=VARCHAR},
            </if>
            <if test="contactInfo != null">
                #{contactInfo,jdbcType=VARCHAR},
            </if>
            <if test="description != null">
                #{description,jdbcType=VARCHAR},
            </if>
            <if test="balance != null">
                #{balance,jdbcType=DOUBLE},
            </if>
            <if test="availableStatus != null">
                #{availableStatus,jdbcType=INTEGER},
            </if>
            <if test="brand != null">
                #{brand,jdbcType=VARCHAR},
            </if>
            <if test="flow != null">
                #{flow,jdbcType=DOUBLE},
            </if>
            <if test="totalPoint != null">
                #{totalPoint,jdbcType=DOUBLE},
            </if>
            <if test="pointBalance != null">
                #{pointBalance,jdbcType=DOUBLE},
            </if>
            <if test="consumePoint != null">
                #{consumePoint,jdbcType=VARCHAR},
            </if>
            <if test="promotionPoint != null">
                #{promotionPoint,jdbcType=VARCHAR},
            </if>
            <if test="synchronizedTime!=null">
                #{synchronizedTime,jdbcType=TIMESTAMP},
            </if>
        </trim>
    </insert>
    <update id="updateByPrimaryKeySelective" parameterType="com.cmit.testing.entity.SimCard">
        
        update sim_card
            <trim prefix="set" suffixOverrides=",">
                <if test='operator != null and operator != ""'>
                    operator = #{operator,jdbcType=VARCHAR},
                </if>
                <if test='province != null and province != ""'>
                    province = #{province,jdbcType=VARCHAR},
                </if>
                <if test='phone != null and phone != ""'>
                    phone = #{phone,jdbcType=VARCHAR},
                </if>
                <if test='serviceCode != null and serviceCode != ""'>
                    service_code = #{serviceCode,jdbcType=VARCHAR},
                </if>
                <if test='imsi != null and imsi != ""'>
                    imsi = #{imsi,jdbcType=VARCHAR},
                </if>
                <if test="monthCost != null">
                    month_cost = #{monthCost,jdbcType=DOUBLE},
                </if>
                <if test='monthCostInfo != null and monthCostInfo != ""'>
                    month_cost_info = #{monthCostInfo,jdbcType=VARCHAR},
                </if>
                <if test="status != null">
                    status = #{status,jdbcType=INTEGER},
                </if>
                <if test="cancelTime != null">
                    cancel_time = #{cancelTime,jdbcType=TIMESTAMP},
                </if>
                <if test='simHost != null and simHost != ""'>
                    sim_host = #{simHost,jdbcType=VARCHAR},
                </if>
                <if test='contactInfo != null and contactInfo != ""'>
                    contact_info = #{contactInfo,jdbcType=VARCHAR},
                </if>
                <if test='description != null and description != ""'>
                    description = #{description,jdbcType=VARCHAR},
                </if>
                <if test="balance != null">
                    balance = #{balance,jdbcType=DOUBLE},
                </if>
                <if test="availableStatus != null">
                    available_status = #{availableStatus,jdbcType=INTEGER},
                </if>
                <if test='brand != null and brand != ""'>
                    brand = #{brand,jdbcType=VARCHAR},
                </if>
                <if test="flow != null">
                    flow = #{flow,jdbcType=DOUBLE},
                </if>
                <if test="totalPoint != null">
                    total_point = #{totalPoint,jdbcType=DOUBLE},
                </if>
                <if test="pointBalance != null">
                    point_balance = #{pointBalance,jdbcType=DOUBLE},
                </if>
                <if test='consumePoint != null and consumePoint != ""'>
                    consume_point = #{consumePoint,jdbcType=VARCHAR},
                </if>
                <if test='promotionPoint != null and promotionPoint != ""'>
                    promotion_point = #{promotionPoint,jdbcType=VARCHAR},
                </if>
                <if test="synchronizedTime!=null">
                    synchronized_time=#{synchronizedTime,jdbcType=TIMESTAMP},
                </if>
                <if test="disableStatus!=null">
                    disable_status=#{disableStatus,jdbcType=INTEGER},
                </if>
           </trim>
        where id = #{id,jdbcType=INTEGER}
    </update>

    <update id="updateStatusByImsi" parameterType="com.cmit.testing.entity.SimCard">
        UPDATE sim_card
        <set>
            <if test="disableStatus != null">
                disable_status = #{disableStatus,jdbcType=INTEGER}
            </if>
            <if test="status != null">
                status = #{status,jdbcType=INTEGER},
            </if>
            <if test="availableStatus != null">
                available_status = #{availableStatus,jdbcType=INTEGER},
            </if>
        </set>
        WHERE
            imsi IN
            <foreach collection="imsiList" item="imsi" separator="," open="(" close=")">
                #{imsi,jdbcType=VARCHAR}
            </foreach>
    </update>


    <update id="updateByPrimaryKey" parameterType="com.cmit.testing.entity.SimCard">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        update sim_card
        set operator = #{operator,jdbcType=VARCHAR},
        province = #{province,jdbcType=VARCHAR},
        phone = #{phone,jdbcType=VARCHAR},
        service_code = #{serviceCode,jdbcType=VARCHAR},
        imsi = #{imsi,jdbcType=VARCHAR},
        month_cost = #{monthCost,jdbcType=DOUBLE},
        month_cost_info = #{monthCostInfo,jdbcType=VARCHAR},
        status = #{status,jdbcType=INTEGER},
        cancel_time = #{cancelTime,jdbcType=TIMESTAMP},
        sim_host = #{simHost,jdbcType=VARCHAR},
        contact_info = #{contactInfo,jdbcType=VARCHAR},
        description = #{description,jdbcType=VARCHAR},
        balance = #{balance,jdbcType=DOUBLE},
        available_status = #{availableStatus,jdbcType=INTEGER},
        brand = #{brand,jdbcType=VARCHAR},
        flow = #{flow,jdbcType=DOUBLE},
        total_point = #{totalPoint,jdbcType=DOUBLE},
        point_balance = #{pointBalance,jdbcType=DOUBLE},
        consume_point = #{consumePoint,jdbcType=VARCHAR},
        promotion_point = #{promotionPoint,jdbcType=VARCHAR},
        synchronized_time=#{synchronizedTime,jdbcType=TIMESTAMP},
        disable_status=#{disableStatus,jdbcType=INTEGER}
        where id = #{id,jdbcType=INTEGER}
    </update>

    <select id="getAllRecords" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from sim_card
    </select>

    <select id="findByPage" parameterType="com.cmit.testing.entity.SimCard" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from sim_card where 1=1
        <if test="brand != null and brand != ''">
            AND brand LIKE CONCAT('%', #{brand }, '%')
        </if>
        <if test="province != null and province != ''">
            AND province LIKE CONCAT('%', #{province }, '%')
        </if>
        <if test="phone != null and phone != ''">
            AND phone LIKE CONCAT('%', #{phone }, '%')
        </if>
        <if test="maxBalance != null">
            AND balance &lt;= #{maxBalance}
        </if>
        <if test="minBalance != null">
            AND balance >= #{minBalance}
        </if>
        ORDER BY id DESC
    </select>

    <select id="getByPhone" parameterType="java.lang.String" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from sim_card
        WHERE
        phone = #{phone}
    </select>

    <select id="getAllRecordsBySimCard" resultType="com.cmit.testing.entity.SimCard"
            parameterType="com.cmit.testing.entity.SimCard">
        select 	DISTINCT(s.phone),s.disable_status AS disableStatus,
        s.id, s.operator, s.province, s.service_code AS serviceCode, s.imsi, s.month_cost AS monthCost,
        s.month_cost_info AS monthCostInfo, s.status,
        s.cancel_time AS cancelTime, s.sim_host AS simHost, s.contact_info AS contactInfo, s.description, s.balance,
        s.available_status AS availableStatus, s.brand, s.flow,
        s.total_point AS totalPoint, s.point_balance AS pointBalance, s.consume_point AS consumePoint, s.promotion_point
        AS promotionPoint,se.equipment_type AS equipmentType
        from sim_card s left join sim_equipment se on s.imsi=se.imsi
        <if test="orderStatus != null ">
            ,(select phone from order_relationship o
            LEFT JOIN product p ON o.product_id = p.id WHERE 1=1 in
            <foreach item="pd" collection="product" open="(" close=")" separator=",">
                #{pd}
            </foreach>
            ) a
        </if>
        WHERE 1=1
        <if test="orderStatus==0 and orderStatus!=1">
            AND s.phone not in (a.phone) <!--未办理-->
        </if>
        <if test="orderStatus==1 and orderStatus!=0">
            AND s.phone in (a.phone) <!--已办理-->
        </if>
        <if test="operator != null and operator != ''">
            AND s.operator = #{operator,jdbcType=VARCHAR}
        </if>
        <if test="provinceList != null and provinceList.size>0">
            AND s.province IN
            <foreach item="province" collection="provinceList" open="(" close=")" separator=",">
                #{province}
            </foreach>
        </if>
        <if test="brand != null and brand != ''">
            AND s.brand LIKE CONCAT('%', #{brand }, '%')
        </if>
        <if test="phone != null and phone != ''">
            AND s.phone LIKE CONCAT('%', #{phone}, '%')
        </if>
        <if test="serviceCode != null and serviceCode != ''">
            AND s.service_code = #{serviceCode,jdbcType=VARCHAR}
        </if>
        <if test="imsi != null and imsi != ''">
            AND s.imsi = #{imsi,jdbcType=VARCHAR}
        </if>
        <if test="maxMonthCost != null">
            AND s.balance &lt;= #{maxMonthCost}
        </if>
        <if test="minMonthCost != null">
            AND s.balance >= #{minMonthCost}
        </if>
        <if test="monthCostInfo != null and monthCostInfo != ''">
            AND s.month_cost_info = #{monthCostInfo,jdbcType=VARCHAR}
        </if>
        <if test="status != null and status != ''">
            AND s.status = #{status,jdbcType=VARCHAR}
        </if>
        <if test="cancelTime != null and cancelTime != ''">
            AND s.cancel_time = #{cancelTime,jdbcType=VARCHAR}
        </if>
        <if test="simHost != null and simHost != ''">
            AND s.sim_host = #{simHost,jdbcType=VARCHAR}
        </if>
        <if test="contactInfo != null  and contactInfo != ''">
            AND s.contact_info = #{contactInfo,jdbcType=VARCHAR}
        </if>
        <if test="description != null  and description != ''">
            AND s.description = #{description,jdbcType=VARCHAR}
        </if>
        <if test="minBalance != null">
            AND s.balance >= #{minBalance,jdbcType=DOUBLE}
        </if>
        <if test="maxBalance != null">
            AND s.balance &lt;= #{maxBalance}
        </if>
    </select>

    <!--sim卡数据统计（free：空闲，takeUp：占用，normal：正常，shutdown：停机-->
    <select id="simCardCount" resultType="java.util.Map">
    SELECT
    count(IF(status = 1, TRUE, NULL)) AS free,
    count(IF(status = 0 , TRUE , NULL)) AS takeUp,
    count(IF(available_status = 1, TRUE, NULL)) AS normal,
    count(IF(available_status = 0 , TRUE, NULL)) AS shutdown
    FROM
      sim_card
  </select>
    <!-- 根据主键批量删除 -->
    <delete id="deleteByIds" parameterType="java.lang.Integer">
        delete from sim_card
        where id IN
        <foreach item="id" collection="ids" open="(" close=")" separator=",">
            #{id,jdbcType=INTEGER}
        </foreach>
    </delete>
    <select id="queryByIds" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from sim_card
        where id in
        <foreach item="id" collection="ids" open="(" close=")" separator=",">
            #{id}
        </foreach>
    </select>
</mapper>